<!--pages/common/login/index.wxml-->
<view class="login-container">
  <!-- 顶部Logo区域 -->
  <view class="logo-section">
    <image class="logo" src="/assets/images/logo.png" mode="aspectFit" />
    <text class="app-name">不止一间自习室</text>
    <text class="app-slogan">专注学习，成就梦想</text>
  </view>

  <!-- 登录表单区域 -->
  <view class="login-form">
    <!-- 微信登录按钮 -->
    <van-button
      type="success"
      size="large"
      round
      loading="{{ loginLoading }}"
      loading-text="登录中..."
      bindtap="onWxLogin"
      custom-class="wx-login-btn"
    >
      <van-icon name="wechat" size="20px" />
      <text class="btn-text">微信快速登录</text>
    </van-button>

    <!-- 手机号登录 -->
    <view class="phone-login" wx:if="{{ showPhoneLogin }}">
      <van-field
        value="{{ phoneNumber }}"
        placeholder="请输入手机号"
        type="number"
        maxlength="11"
        bind:input="onPhoneInput"
        border="{{ false }}"
        custom-class="phone-input"
      />
      
      <view class="verify-section">
        <van-field
          value="{{ verifyCode }}"
          placeholder="请输入验证码"
          type="number"
          maxlength="6"
          bind:input="onCodeInput"
          border="{{ false }}"
          custom-class="code-input"
          use-button-slot
        >
          <van-button
            slot="button"
            size="small"
            type="primary"
            plain
            disabled="{{ !canSendCode || sendCodeLoading }}"
            loading="{{ sendCodeLoading }}"
            bindtap="onSendCode"
          >
            {{ sendCodeText }}
          </van-button>
        </van-field>
      </view>

      <van-button
        type="primary"
        size="large"
        round
        loading="{{ phoneLoginLoading }}"
        loading-text="登录中..."
        disabled="{{ !canPhoneLogin }}"
        bindtap="onPhoneLogin"
        custom-class="phone-login-btn"
      >
        手机号登录
      </van-button>
    </view>

    <!-- 切换登录方式 -->
    <view class="switch-login" bindtap="onSwitchLoginType">
      <text class="switch-text">
        {{ showPhoneLogin ? '使用微信登录' : '使用手机号登录' }}
      </text>
    </view>

    <!-- 其他登录方式 -->
    <view class="other-login" wx:if="{{ !showPhoneLogin }}">
      <view class="divider">
        <text class="divider-text">其他登录方式</text>
      </view>
      
      <view class="login-methods">
        <view class="login-method" bindtap="onPhoneQuickLogin">
          <van-icon name="phone-o" size="24px" color="#4A90E2" />
          <text>手机号</text>
        </view>
        
        <!-- 可以添加更多登录方式 -->
      </view>
    </view>
  </view>

  <!-- 用户协议 -->
  <view class="agreement-section">
    <view class="agreement-checkbox" bindtap="onAgreementToggle">
      <van-icon 
        name="{{ agreedToTerms ? 'success' : 'circle' }}" 
        size="16px" 
        color="{{ agreedToTerms ? '#4A90E2' : '#CCCCCC' }}"
      />
      <text class="agreement-text">
        我已阅读并同意
        <text class="link" bindtap="onViewTerms" data-type="terms">《用户协议》</text>
        和
        <text class="link" bindtap="onViewTerms" data-type="privacy">《隐私政策》</text>
      </text>
    </view>
  </view>

  <!-- 帮助信息 -->
  <view class="help-section">
    <text class="help-text">登录即可享受完整的自习室预订服务</text>
    <view class="help-links">
      <text class="help-link" bindtap="onContactService">联系客服</text>
      <text class="help-link" bindtap="onViewHelp">使用帮助</text>
    </view>
  </view>
</view>

<!-- 用户协议弹窗 -->
<van-popup
  show="{{ showTermsModal }}"
  position="center"
  round
  custom-style="width: 80%; max-height: 70%;"
  bind:close="onCloseTermsModal"
>
  <view class="terms-modal">
    <view class="terms-header">
      <text class="terms-title">{{ termsType === 'terms' ? '用户协议' : '隐私政策' }}</text>
      <van-icon name="cross" bindtap="onCloseTermsModal" />
    </view>
    <scroll-view class="terms-content" scroll-y>
      <text class="terms-text">{{ termsContent }}</text>
    </scroll-view>
    <view class="terms-footer">
      <van-button type="primary" size="small" bindtap="onCloseTermsModal">
        我知道了
      </van-button>
    </view>
  </view>
</van-popup>

<!-- Toast提示 -->
<van-toast id="van-toast" />